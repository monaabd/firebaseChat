
<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Firebase- Chat sidan</title>
        <meta name="description" content="En interaktiv genomg책ng av Brackets.">
    
    
    <script src="https://www.gstatic.com/firebasejs/3.7.1/firebase.js"></script>
    <script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyCKCVk_dvlDA0Zkx5PXRhSBP9xGtILzzJk",
    authDomain: "fir-js2-chat.firebaseapp.com",
    databaseURL: "https://fir-js2-chat.firebaseio.com",
    storageBucket: "fir-js2-chat.appspot.com",
    messagingSenderId: "123347826934"
  };
  firebase.initializeApp(config);

    </script>
        
    <script type="text/javascript">
      
        
      window.addEventListener('load',function(){
         
          
          
        var input= document.getElementById('userInput'); 
        let loginButton= document.getElementById('loginButton'); 
        let logoutButton= document.getElementById('logoutButton'); 
        let message= document.getElementById('message'); 
        let sendButton= document.getElementById('sendButton'); 
        let displayAll=document.getElementById("displayAll");
         let list =document.getElementById("list"); 
        // *************************************************
          //Firebase sortering project
          
        let sortName =document.getElementById('sortName'); 
        let sortDate =document.getElementById('sortDate');
        let sortMessage =document.getElementById('sortMessage');
        let sortedMessage =document.getElementById('sortedMessage');
          
          
      //*******************************************************    
          var currentTime = new Date(),
          hours = currentTime.getHours(),
          minutes = currentTime.getMinutes();
            if (minutes < 10) {
	             minutes = "0" + minutes;
             }              
    
        sendButton.addEventListener('click',function(event){
            
            displayAll.innerHTML="";
            let userName= input.value;
            let chatMessage= message.value;
    //access to database  
            
             firebase.database().ref('username/').push({ 
                 name: userName,
                 chatMessage: chatMessage,  
                 time: hours + ":" + minutes +"" 
                   })
              
             chatMessage= "";
        });//sendButton eventlistenter
         
          
 // below is for firebase changes..
          
          loginButton.addEventListener('click',function(event){
              firebase.database().ref('username/').on('value',function(snapshot){
          //******** firebase sorting
                  
           //*******************************************       
                 let dataObject = snapshot.val();
                   for(let i in dataObject) {
                       //console.log(dataObject[i].message);
                       let li= document.createElement('li');
                       li.innerHTML= " From: " + dataObject[i].name + "  , Message: " + dataObject[i].chatMessage +  "  , At:  "  + dataObject[i].time;
                       
                       list.appendChild(li);
                       displayAll.insertBefore(li,displayAll.firstChild);
                       //display other buttons
                       logoutButton.style.display="inline";
                       loginButton.style.display="none";
                       //////////////////////////////////
                      //Utl채mning4  
                       // 3 knappaer ska hittas n채r vi logga ni 
                       
                   }
              }) ;//firebase function value
              
          });//login button event
          
          logoutButton.addEventListener('click',function(event){
             
             window.location.reload();
              logoutButton.style.display="none";
          })//logout event
                      
          sortName.addEventListener('click',function(event){
              
                 let db = firebase.database();
                 db.ref('username/').orderByChild('name').on('value', function(snapshot) {
               // snapshot.val();  // VARNING! Beh책ller inte sorteringen
                snapshot.forEach( child => {
                    let objekt = child.val();  // objekten kommer i ordning
                    sortedMessage.innerHTML=db.name;
                })
            });
   
          });//sort name event listener
    
          
     }) ;//windows load             
    </script>
        
    <style>
        body{
            background: url("chat.jpg") no-repeat ;
            -webkit-background-size: cover;
              -moz-background-size: cover;
              -o-background-size: cover;
              background-size: cover;
        }
        #displayAll{ background-color: azure ;
                   width: 340px}
        #userInput{background-color: aqua }
        #message { background-color: aqua
                }
        #logoutButton {
            background-color: fuchsia;
            font-size:20px ;
            
        }
        #sendButton {
             font-size:18px ;
        }
        #loginButton {
             font-size:20px ;
        }
        #sortedMessage { background-color: aliceblue}
    </style>
</head>        
    <body>
        <h1 style=color:pink;> Let's Chat and Enjoy</h2>
        <div>
        <input type="text" id="userInput" placeholder="User Name">
            
        <button id="loginButton"> Login</button>
        <br>
        <br>    
        <br>
        <input id="message" type="text" placeholder="Write  Your Message">
        <button id="sendButton">Send  Message</button>
        <br>
        <br>    
            <div id="displayAll"> 
            <ul id="list"> </ul>
            </div>
        <br>    
        <button id="logoutButton"> Log Out</button>
        <br>
        <br>  
        <br>    
        <button id="sortName"> Sender's Name</button>   
        <button id="sortDate"> Sort time/Date</button> 
        <button id="sortMessage"> Sort Message</button> 
        <div id="sortedMessage"> </div> 
            
        </div>
        

 </body>
 </html>
